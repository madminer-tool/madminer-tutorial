
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MadMiner physics tutorial (part 2A) &#8212; MadMiner Tutorial</title>
    
  <link href="../../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="MadMiner physics tutorial (part 2B)" href="2b_delphes_analysis.html" />
    <link rel="prev" title="Choose your adventure" href="../../5_data_generation.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">MadMiner Tutorial</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../0_intro.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../1_video.html">
   Demo video
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Tutorial
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../2_preliminaries.html">
   Preliminaries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../3_overview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="1_setup_process.html">
   Define process to study
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../4_morphing.html">
     Morphing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../morphing/basis_chooser.html">
     Morphing demo
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../5_data_generation.html">
   Create training data
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Parton level
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2b_delphes_analysis.html">
     Delphes level
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../6_metric_selection.html">
   Train model
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="3a_likelihood_ratio.html">
     Likelihood ratio
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="3b_score.html">
     Score
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="3c_likelihood.html">
     Likelihood
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../7_statistics.html">
   Statistical Analysis
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="4a_limits.html">
     Limits on EFT parameters
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="4b_fisher_information.html">
     Fisher Information
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="4c_information_geometry.html">
     Information Geometry
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../8_congratulations.html">
   Congratulations
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Appendix
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../appendix/notebooks/A1_systematic_uncertainties.html">
   Systematic uncertainties
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../appendix/notebooks/A2_ensemble_methods.html">
   Ensemble methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../appendix/notebooks/A3_reweighting_samples.html">
   Reweighting existing samples
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Deploy on REANA
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../reana/0_introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../reana/1_demo_video.html">
   Demo video
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../reana/2_workflow_setup.html">
   Setup workflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../reana/3_parametrization.html">
   Parametrization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../reana/4_reana_setup.html">
   Setup REANA / MLFlow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../reana/5_run_remotely.html">
   Run remotely
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../reana/6_run_locally.html">
   Run locally
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../_sources/tutorial/notebooks/general/2a_parton_analysis.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/cranmer/madminer-tutorial/master?urlpath=tree/book/tutorial/notebooks/general/2a_parton_analysis.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preparations">
   0. Preparations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generate-events">
   1. Generate events
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#backgrounds">
     Backgrounds
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prepare-analysis-of-the-lhe-samples">
   2. Prepare analysis of the LHE samples
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#smearing-functions-to-model-the-detector-response">
   3. Smearing functions to model the detector response
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#observables-and-cuts">
   4. Observables and cuts
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-analysis-and-store-processes-events">
   5. Run analysis and store processes events
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-distributions">
   6. Plot distributions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#combine-and-shuffle-different-samples">
   7. Combine and shuffle different samples
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="madminer-physics-tutorial-part-2a">
<h1>MadMiner physics tutorial (part 2A)<a class="headerlink" href="#madminer-physics-tutorial-part-2a" title="Permalink to this headline">¶</a></h1>
<p>Johann Brehmer, Felix Kling, Irina Espejo, and Kyle Cranmer 2018-2019</p>
<p>In this second part of the tutorial, we’ll generate events and extract the observables and weights from them. You have two options: In this notebook we’ll do this at parton level, in the alternative part 2b we use Delphes.</p>
<div class="section" id="preparations">
<h2>0. Preparations<a class="headerlink" href="#preparations" title="Permalink to this headline">¶</a></h2>
<p>Before you execute this notebook, make sure you have a running installation of MadGraph.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">from</span> <span class="nn">madminer.core</span> <span class="kn">import</span> <span class="n">MadMiner</span>
<span class="kn">from</span> <span class="nn">madminer.lhe</span> <span class="kn">import</span> <span class="n">LHEReader</span>
<span class="kn">from</span> <span class="nn">madminer.sampling</span> <span class="kn">import</span> <span class="n">combine_and_shuffle</span>
<span class="kn">from</span> <span class="nn">madminer.plotting</span> <span class="kn">import</span> <span class="n">plot_distributions</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># MadMiner output</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)-5.5s</span><span class="s1"> </span><span class="si">%(name)-20.20s</span><span class="s1"> </span><span class="si">%(levelname)-7.7s</span><span class="s1"> </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">,</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span>
<span class="p">)</span>

<span class="c1"># Output of all other modules (e.g. matplotlib)</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">loggerDict</span><span class="p">:</span>
    <span class="k">if</span> <span class="s2">&quot;madminer&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Please enter here the environment variable pointing o your MG5 installation folder.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mg_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;MG_FOLDER_PATH&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="generate-events">
<h2>1. Generate events<a class="headerlink" href="#generate-events" title="Permalink to this headline">¶</a></h2>
<p>Let’s load our setup:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">miner</span> <span class="o">=</span> <span class="n">MadMiner</span><span class="p">()</span>
<span class="n">miner</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/setup.h5&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16:39 madminer.utils.inter DEBUG   HDF5 file does not contain is_reference field.
16:39 madminer.core        INFO    Found 2 parameters:
16:39 madminer.core        INFO       CWL2 (LHA: dim6 2, maximal power in squared ME: (2,), range: (-20.0, 20.0))
16:39 madminer.core        INFO       CPWL2 (LHA: dim6 5, maximal power in squared ME: (2,), range: (-20.0, 20.0))
16:39 madminer.core        INFO    Found 6 benchmarks:
16:39 madminer.core        INFO       sm: CWL2 = 0.00e+00, CPWL2 = 0.00e+00
16:39 madminer.core        INFO       w: CWL2 = 15.20, CPWL2 = 0.10
16:39 madminer.core        INFO       neg_w: CWL2 = -1.54e+01, CPWL2 = 0.20
16:39 madminer.core        INFO       ww: CWL2 = 0.30, CPWL2 = 15.10
16:39 madminer.core        INFO       neg_ww: CWL2 = 0.40, CPWL2 = -1.53e+01
16:39 madminer.core        INFO       morphing_basis_vector_5: CWL2 = 16.88, CPWL2 = 14.95
16:39 madminer.core        INFO    Found morphing setup with 6 components
16:39 madminer.core        INFO    Did not find systematics setup.
</pre></div>
</div>
</div>
</div>
<p>In a next step, MadMiner starts MadGraph to generate events and calculate the weights. You can use <code class="docutils literal notranslate"><span class="pre">run()</span></code> or <code class="docutils literal notranslate"><span class="pre">run_multiple()</span></code>; the latter allows to generate different runs with different run cards and optimizing the phase space for different benchmark points.</p>
<p>In either case, you have to provide paths to the process card, run card, param card (the entries corresponding to the parameters of interest will be automatically adapted), and an empty reweight card. Log files in the <code class="docutils literal notranslate"><span class="pre">log_directory</span></code> folder collect the MadGraph output and are important for debugging.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">sample_benchmark</span></code> (or in the case of <code class="docutils literal notranslate"><span class="pre">run_all</span></code>, <code class="docutils literal notranslate"><span class="pre">sample_benchmarks</span></code>) option can be used to specify which benchmark should be used for sampling, i.e. for which benchmark point the phase space is optimized. If you just use one benchmark, reweighting to far-away points in parameter space can lead to large event weights and thus large statistical fluctuations. It is therefore often a good idea to combine a lot of events at the “reference hypothesis” (for us the SM) and smaller samples from other benchmarks that span the parameter space.</p>
<p>One slight annoyance is that MadGraph only supports Python 2. The <code class="docutils literal notranslate"><span class="pre">run()</span></code> and <code class="docutils literal notranslate"><span class="pre">run_multiple()</span></code> commands have a keyword <code class="docutils literal notranslate"><span class="pre">initial_command</span></code> that let you load a virtual environment in which <code class="docutils literal notranslate"><span class="pre">python</span></code> maps to Python 2 (which is what we do below). Alternatively / additionally you can set <code class="docutils literal notranslate"><span class="pre">python2_override=True</span></code>, which calls <code class="docutils literal notranslate"><span class="pre">python2.7</span></code> instead of <code class="docutils literal notranslate"><span class="pre">python</span></code> to start MadGraph.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">miner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">sample_benchmark</span><span class="o">=</span><span class="s1">&#39;sm&#39;</span><span class="p">,</span>
    <span class="n">mg_directory</span><span class="o">=</span><span class="n">mg_dir</span><span class="p">,</span>
    <span class="n">mg_process_directory</span><span class="o">=</span><span class="s1">&#39;./mg_processes/signal1&#39;</span><span class="p">,</span>
    <span class="n">proc_card_file</span><span class="o">=</span><span class="s1">&#39;cards/proc_card_signal.dat&#39;</span><span class="p">,</span>
    <span class="n">param_card_template_file</span><span class="o">=</span><span class="s1">&#39;cards/param_card_template.dat&#39;</span><span class="p">,</span>
    <span class="n">run_card_file</span><span class="o">=</span><span class="s1">&#39;cards/run_card_signal_large.dat&#39;</span><span class="p">,</span>
    <span class="n">log_directory</span><span class="o">=</span><span class="s1">&#39;logs/signal&#39;</span><span class="p">,</span>
    <span class="n">initial_command</span><span class="o">=</span><span class="s2">&quot;source activate python2&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16:39 madminer.utils.inter INFO    Generating MadGraph process folder from cards/proc_card_signal.dat at ./mg_processes/signal1
16:39 madminer.core        INFO    Run 0
16:39 madminer.core        INFO      Sampling from benchmark: sm
16:39 madminer.core        INFO      Original run card:       cards/run_card_signal_large.dat
16:39 madminer.core        INFO      Original Pythia8 card:   None
16:39 madminer.core        INFO      Original config card:    None
16:39 madminer.core        INFO      Copied run card:         /madminer/cards/run_card_0.dat
16:39 madminer.core        INFO      Copied Pythia8 card:     None
16:39 madminer.core        INFO      Copied config card:      None
16:39 madminer.core        INFO      Param card:              /madminer/cards/param_card_0.dat
16:39 madminer.core        INFO      Reweight card:           /madminer/cards/reweight_card_0.dat
16:39 madminer.core        INFO      Log file:                run_0.log
16:39 madminer.core        INFO    Creating param and reweight cards in ./mg_processes/signal1//madminer/cards/param_card_0.dat, ./mg_processes/signal1//madminer/cards/reweight_card_0.dat
16:39 madminer.utils.inter INFO    Starting MadGraph and Pythia in ./mg_processes/signal1
16:52 madminer.core        INFO    Finished running MadGraph! Please check that events were succesfully generated in the following folders:

./mg_processes/signal1/Events/run_01
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">additional_benchmarks</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;ww&#39;</span><span class="p">,</span> <span class="s1">&#39;neg_w&#39;</span><span class="p">,</span> <span class="s1">&#39;neg_ww&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">miner</span><span class="o">.</span><span class="n">run_multiple</span><span class="p">(</span>
    <span class="n">sample_benchmarks</span><span class="o">=</span><span class="n">additional_benchmarks</span><span class="p">,</span>
    <span class="n">mg_directory</span><span class="o">=</span><span class="n">mg_dir</span><span class="p">,</span>
    <span class="n">mg_process_directory</span><span class="o">=</span><span class="s1">&#39;./mg_processes/signal2&#39;</span><span class="p">,</span>
    <span class="n">proc_card_file</span><span class="o">=</span><span class="s1">&#39;cards/proc_card_signal.dat&#39;</span><span class="p">,</span>
    <span class="n">param_card_template_file</span><span class="o">=</span><span class="s1">&#39;cards/param_card_template.dat&#39;</span><span class="p">,</span>
    <span class="n">run_card_files</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cards/run_card_signal_small.dat&#39;</span><span class="p">],</span>
    <span class="n">log_directory</span><span class="o">=</span><span class="s1">&#39;logs/signal&#39;</span><span class="p">,</span>
    <span class="n">initial_command</span><span class="o">=</span><span class="s2">&quot;source activate python2&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16:52 madminer.utils.inter INFO    Generating MadGraph process folder from cards/proc_card_signal.dat at ./mg_processes/signal2
16:52 madminer.core        INFO    Run 0
16:52 madminer.core        INFO      Sampling from benchmark: w
16:52 madminer.core        INFO      Original run card:       cards/run_card_signal_small.dat
16:52 madminer.core        INFO      Original Pythia8 card:   None
16:52 madminer.core        INFO      Original config card:    None
16:52 madminer.core        INFO      Copied run card:         /madminer/cards/run_card_0.dat
16:52 madminer.core        INFO      Copied Pythia8 card:     None
16:52 madminer.core        INFO      Copied config card:      None
16:52 madminer.core        INFO      Param card:              /madminer/cards/param_card_0.dat
16:52 madminer.core        INFO      Reweight card:           /madminer/cards/reweight_card_0.dat
16:52 madminer.core        INFO      Log file:                run_0.log
16:52 madminer.core        INFO    Creating param and reweight cards in ./mg_processes/signal2//madminer/cards/param_card_0.dat, ./mg_processes/signal2//madminer/cards/reweight_card_0.dat
16:52 madminer.utils.inter INFO    Starting MadGraph and Pythia in ./mg_processes/signal2
16:55 madminer.core        INFO    Run 1
16:55 madminer.core        INFO      Sampling from benchmark: ww
16:55 madminer.core        INFO      Original run card:       cards/run_card_signal_small.dat
16:55 madminer.core        INFO      Original Pythia8 card:   None
16:55 madminer.core        INFO      Original config card:    None
16:55 madminer.core        INFO      Copied run card:         /madminer/cards/run_card_1.dat
16:55 madminer.core        INFO      Copied Pythia8 card:     None
16:55 madminer.core        INFO      Copied config card:      None
16:55 madminer.core        INFO      Param card:              /madminer/cards/param_card_1.dat
16:55 madminer.core        INFO      Reweight card:           /madminer/cards/reweight_card_1.dat
16:55 madminer.core        INFO      Log file:                run_1.log
16:55 madminer.core        INFO    Creating param and reweight cards in ./mg_processes/signal2//madminer/cards/param_card_1.dat, ./mg_processes/signal2//madminer/cards/reweight_card_1.dat
16:55 madminer.utils.inter INFO    Starting MadGraph and Pythia in ./mg_processes/signal2
16:57 madminer.core        INFO    Run 2
16:57 madminer.core        INFO      Sampling from benchmark: neg_w
16:57 madminer.core        INFO      Original run card:       cards/run_card_signal_small.dat
16:57 madminer.core        INFO      Original Pythia8 card:   None
16:57 madminer.core        INFO      Original config card:    None
16:57 madminer.core        INFO      Copied run card:         /madminer/cards/run_card_2.dat
16:57 madminer.core        INFO      Copied Pythia8 card:     None
16:57 madminer.core        INFO      Copied config card:      None
16:57 madminer.core        INFO      Param card:              /madminer/cards/param_card_2.dat
16:57 madminer.core        INFO      Reweight card:           /madminer/cards/reweight_card_2.dat
16:57 madminer.core        INFO      Log file:                run_2.log
16:57 madminer.core        INFO    Creating param and reweight cards in ./mg_processes/signal2//madminer/cards/param_card_2.dat, ./mg_processes/signal2//madminer/cards/reweight_card_2.dat
16:57 madminer.utils.inter INFO    Starting MadGraph and Pythia in ./mg_processes/signal2
17:00 madminer.core        INFO    Run 3
17:00 madminer.core        INFO      Sampling from benchmark: neg_ww
17:00 madminer.core        INFO      Original run card:       cards/run_card_signal_small.dat
17:00 madminer.core        INFO      Original Pythia8 card:   None
17:00 madminer.core        INFO      Original config card:    None
17:00 madminer.core        INFO      Copied run card:         /madminer/cards/run_card_3.dat
17:00 madminer.core        INFO      Copied Pythia8 card:     None
17:00 madminer.core        INFO      Copied config card:      None
17:00 madminer.core        INFO      Param card:              /madminer/cards/param_card_3.dat
17:00 madminer.core        INFO      Reweight card:           /madminer/cards/reweight_card_3.dat
17:00 madminer.core        INFO      Log file:                run_3.log
17:00 madminer.core        INFO    Creating param and reweight cards in ./mg_processes/signal2//madminer/cards/param_card_3.dat, ./mg_processes/signal2//madminer/cards/reweight_card_3.dat
17:00 madminer.utils.inter INFO    Starting MadGraph and Pythia in ./mg_processes/signal2
17:03 madminer.core        INFO    Finished running MadGraph! Please check that events were succesfully generated in the following folders:

./mg_processes/signal2/Events/run_01
./mg_processes/signal2/Events/run_02
./mg_processes/signal2/Events/run_03
./mg_processes/signal2/Events/run_04
</pre></div>
</div>
</div>
</div>
<p>This will take a moment – time for a coffee break!</p>
<p>After running any event generation through MadMiner, you should check whether the run succeeded: are the usual output files there, do the log files show any error messages? MadMiner does not (yet) perform any explicit checks, and if something went wrong in the event generation, it will only notice later when trying to load the event files.</p>
<div class="section" id="backgrounds">
<h3>Backgrounds<a class="headerlink" href="#backgrounds" title="Permalink to this headline">¶</a></h3>
<p>We can also easily add other processes like backgrounds. An important option is the <code class="docutils literal notranslate"><span class="pre">is_background</span></code> keyword, which should be used for processes that do <em>not</em> depend on the parameters theta. <code class="docutils literal notranslate"><span class="pre">is_background=True</span></code> will disable the reweighting and re-use the same weights for all cross sections.</p>
<p>To reduce the runtime of the notebook, the background part is commented out here. Feel free to activate it and let it run during a lunch break.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">miner.run(</span>
<span class="sd">    is_background=True,</span>
<span class="sd">    sample_benchmark=&#39;sm&#39;,</span>
<span class="sd">    mg_directory=mg_dir,</span>
<span class="sd">    mg_process_directory=&#39;./mg_processes/background&#39;,</span>
<span class="sd">    proc_card_file=&#39;cards/proc_card_background.dat&#39;,</span>
<span class="sd">    param_card_template_file=&#39;cards/param_card_template.dat&#39;,</span>
<span class="sd">    run_card_file=&#39;cards/run_card_background.dat&#39;,</span>
<span class="sd">    log_directory=&#39;logs/background&#39;,</span>
<span class="sd">)</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>u&quot;\nminer.run(\n    is_background=True,\n    sample_benchmark=&#39;sm&#39;,\n    mg_directory=mg_dir,\n    mg_process_directory=&#39;./mg_processes/background&#39;,\n    proc_card_file=&#39;cards/proc_card_background.dat&#39;,\n    param_card_template_file=&#39;cards/param_card_template.dat&#39;,\n    run_card_file=&#39;cards/run_card_background.dat&#39;,\n    log_directory=&#39;logs/background&#39;,\n)\n&quot;
</pre></div>
</div>
</div>
</div>
<p>Finally, note that both <code class="docutils literal notranslate"><span class="pre">MadMiner.run()</span></code> and <code class="docutils literal notranslate"><span class="pre">MadMiner.run_multiple()</span></code> have a <code class="docutils literal notranslate"><span class="pre">only_create_script</span></code> keyword. If that is set to True, MadMiner will not start the event generation directly, but prepare folders with all the right settings and ready-to-run bash scripts. This might make it much easier to generate Events on a high-performance computing system.</p>
</div>
</div>
<div class="section" id="prepare-analysis-of-the-lhe-samples">
<h2>2. Prepare analysis of the LHE samples<a class="headerlink" href="#prepare-analysis-of-the-lhe-samples" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">madminer.lhe</span></code> submodule allows us to extract observables directly from the parton-level LHE samples, including an approximate description of the detector response with smearing functions. The central object is an instance of the <code class="docutils literal notranslate"><span class="pre">LHEProcessor</span></code> class, which has to be initialized with a MadMiner file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lhe</span> <span class="o">=</span> <span class="n">LHEReader</span><span class="p">(</span><span class="s1">&#39;data/setup.h5&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17:03 madminer.utils.inter DEBUG   HDF5 file does not contain is_reference field.
</pre></div>
</div>
</div>
</div>
<p>After creating the <code class="docutils literal notranslate"><span class="pre">LHEReader</span></code> object, one can add a number of event samples (the output of running MadGraph in step 1) with the <code class="docutils literal notranslate"><span class="pre">add_sample()</span></code> function.</p>
<p>In addition, you have to provide the information which sample was generated from which benchmark with the <code class="docutils literal notranslate"><span class="pre">sampled_from_benchmark</span></code> keyword, and set <code class="docutils literal notranslate"><span class="pre">is_background=True</span></code> for all background samples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lhe</span><span class="o">.</span><span class="n">add_sample</span><span class="p">(</span>
    <span class="n">lhe_filename</span><span class="o">=</span><span class="s1">&#39;mg_processes/signal1/Events/run_01/unweighted_events.lhe.gz&#39;</span><span class="p">,</span>
    <span class="n">sampled_from_benchmark</span><span class="o">=</span><span class="s1">&#39;sm&#39;</span><span class="p">,</span>
    <span class="n">is_background</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">k_factor</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">benchmark</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">additional_benchmarks</span><span class="p">):</span>
    <span class="n">lhe</span><span class="o">.</span><span class="n">add_sample</span><span class="p">(</span>
        <span class="n">lhe_filename</span><span class="o">=</span><span class="s1">&#39;mg_processes/signal2/Events/run_0</span><span class="si">{}</span><span class="s1">/unweighted_events.lhe.gz&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">sampled_from_benchmark</span><span class="o">=</span><span class="n">benchmark</span><span class="p">,</span>
        <span class="n">is_background</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">k_factor</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
    <span class="p">)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">lhe.add_sample(</span>
<span class="sd">    lhe_filename=&#39;mg_processes/background/Events/run_01/unweighted_events.lhe.gz&#39;,</span>
<span class="sd">    sampled_from_benchmark=&#39;sm&#39;,</span>
<span class="sd">    is_background=True,</span>
<span class="sd">    k_factor=1.0,</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17:03 madminer.lhe         DEBUG   Adding event sample mg_processes/signal1/Events/run_01/unweighted_events.lhe.gz
17:03 madminer.lhe         DEBUG   Adding event sample mg_processes/signal2/Events/run_01/unweighted_events.lhe.gz
17:03 madminer.lhe         DEBUG   Adding event sample mg_processes/signal2/Events/run_02/unweighted_events.lhe.gz
17:03 madminer.lhe         DEBUG   Adding event sample mg_processes/signal2/Events/run_03/unweighted_events.lhe.gz
17:03 madminer.lhe         DEBUG   Adding event sample mg_processes/signal2/Events/run_04/unweighted_events.lhe.gz
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>u&quot;\nlhe.add_sample(\n    lhe_filename=&#39;mg_processes/background/Events/run_01/unweighted_events.lhe.gz&#39;,\n    sampled_from_benchmark=&#39;sm&#39;,\n    is_background=True,\n    k_factor=1.0,\n&quot;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="smearing-functions-to-model-the-detector-response">
<h2>3. Smearing functions to model the detector response<a class="headerlink" href="#smearing-functions-to-model-the-detector-response" title="Permalink to this headline">¶</a></h2>
<p>Now we have to define the smearing functions that are used (in lieu of a proper shower and detector simulation). Here we will assume a simple 10% uncertainty on the jet energy measurements and a <span class="math notranslate nohighlight">\(\pm 0.1\)</span> smearing for jet <span class="math notranslate nohighlight">\(\eta\)</span> and <span class="math notranslate nohighlight">\(\phi\)</span>. The transverse momenta of the jets are then derived from the smeared energy and the on-shell condition for the quarks (this is what <code class="docutils literal notranslate"><span class="pre">pt_resolution_abs=None</span></code> does). The photons from the Higgs are assumed to be measured perfectly (otherwise we’d have to call <code class="docutils literal notranslate"><span class="pre">set_smearing</span></code> another time with <code class="docutils literal notranslate"><span class="pre">pdgis=[22]</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lhe</span><span class="o">.</span><span class="n">set_smearing</span><span class="p">(</span>
    <span class="n">pdgids</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">],</span>   <span class="c1"># Partons giving rise to jets</span>
    <span class="n">energy_resolution_abs</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
    <span class="n">energy_resolution_rel</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">pt_resolution_abs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">pt_resolution_rel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">eta_resolution_abs</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">eta_resolution_rel</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
    <span class="n">phi_resolution_abs</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">phi_resolution_rel</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In addition, we can define noise that only affects MET. This adds Gaussian noise with mean 0 and std <code class="docutils literal notranslate"><span class="pre">abs_</span> <span class="pre">+</span> <span class="pre">rel</span> <span class="pre">*</span> <span class="pre">HT</span></code> to MET_x and MET_y separately.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lhe</span><span class="o">.</span><span class="n">set_met_noise</span><span class="p">(</span><span class="n">abs_</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span> <span class="n">rel</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="observables-and-cuts">
<h2>4. Observables and cuts<a class="headerlink" href="#observables-and-cuts" title="Permalink to this headline">¶</a></h2>
<p>The next step is the definition of observables, either through a Python function or an expression that can be evaluated. Here we demonstrate the latter, which is implemented in <code class="docutils literal notranslate"><span class="pre">add_observable()</span></code>. In the expression string, you can use the terms <code class="docutils literal notranslate"><span class="pre">j[i]</span></code>, <code class="docutils literal notranslate"><span class="pre">e[i]</span></code>, <code class="docutils literal notranslate"><span class="pre">mu[i]</span></code>, <code class="docutils literal notranslate"><span class="pre">a[i]</span></code>, <code class="docutils literal notranslate"><span class="pre">met</span></code>, where the indices <code class="docutils literal notranslate"><span class="pre">i</span></code> refer to a ordering by the transverse momentum. In addition, you can use <code class="docutils literal notranslate"><span class="pre">p[i]</span></code>, which denotes the <code class="docutils literal notranslate"><span class="pre">i</span></code>-th particle in the order given in the LHE sample (which is the order in which the final-state particles where defined in MadGraph).</p>
<p>All of these represent objects inheriting from scikit-hep <a class="reference external" href="http://scikit-hep.org/api/math.html#vector-classes">LorentzVectors</a>, see the link for a documentation of their properties. In addition, they have <code class="docutils literal notranslate"><span class="pre">charge</span></code> and <code class="docutils literal notranslate"><span class="pre">pdg_id</span></code> properties.</p>
<p><code class="docutils literal notranslate"><span class="pre">add_observable()</span></code> has an optional keyword <code class="docutils literal notranslate"><span class="pre">required</span></code>. If <code class="docutils literal notranslate"><span class="pre">required=True</span></code>, we will only keep events where the observable can be parsed, i.e. all involved particles have been detected. If <code class="docutils literal notranslate"><span class="pre">required=False</span></code>, un-parseable observables will be filled with the value of another keyword <code class="docutils literal notranslate"><span class="pre">default</span></code>.</p>
<p>In a realistic project, you would want to add a large number of observables that capture all information in your events. Here we will just define two observables, the transverse momentum of the leading (= higher-pT) jet, and the azimuthal angle between the two leading jets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lhe</span><span class="o">.</span><span class="n">add_observable</span><span class="p">(</span>
    <span class="s1">&#39;pt_j1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;j[0].pt&#39;</span><span class="p">,</span>
    <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">lhe</span><span class="o">.</span><span class="n">add_observable</span><span class="p">(</span>
    <span class="s1">&#39;delta_phi_jj&#39;</span><span class="p">,</span>
    <span class="s1">&#39;j[0].deltaphi(j[1]) * (-1. + 2.*float(j[0].eta &gt; j[1].eta))&#39;</span><span class="p">,</span>
    <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">lhe</span><span class="o">.</span><span class="n">add_observable</span><span class="p">(</span>
    <span class="s1">&#39;met&#39;</span><span class="p">,</span>
    <span class="s1">&#39;met.pt&#39;</span><span class="p">,</span>
    <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17:03 madminer.lhe         DEBUG   Adding optional observable pt_j1 = j[0].pt with default 0.0
17:03 madminer.lhe         DEBUG   Adding required observable delta_phi_jj = j[0].deltaphi(j[1]) * (-1. + 2.*float(j[0].eta &gt; j[1].eta))
17:03 madminer.lhe         DEBUG   Adding required observable met = met.pt
</pre></div>
</div>
</div>
</div>
<p>We can also add cuts, again in parse-able strings. In addition to the objects discussed above, they can contain the observables:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lhe</span><span class="o">.</span><span class="n">add_cut</span><span class="p">(</span><span class="s1">&#39;(a[0] + a[1]).m &gt; 122.&#39;</span><span class="p">)</span>
<span class="n">lhe</span><span class="o">.</span><span class="n">add_cut</span><span class="p">(</span><span class="s1">&#39;(a[0] + a[1]).m &lt; 128.&#39;</span><span class="p">)</span>
<span class="n">lhe</span><span class="o">.</span><span class="n">add_cut</span><span class="p">(</span><span class="s1">&#39;pt_j1 &gt; 20.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17:03 madminer.lhe         DEBUG   Adding cut (a[0] + a[1]).m &gt; 122.
17:03 madminer.lhe         DEBUG   Adding cut (a[0] + a[1]).m &lt; 128.
17:03 madminer.lhe         DEBUG   Adding cut pt_j1 &gt; 20.
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="run-analysis-and-store-processes-events">
<h2>5. Run analysis and store processes events<a class="headerlink" href="#run-analysis-and-store-processes-events" title="Permalink to this headline">¶</a></h2>
<p>The function <code class="docutils literal notranslate"><span class="pre">analyse_samples</span></code> then calculates all observables from the LHE file(s) generated before, applies the smearing, and checks which events pass the cuts:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lhe</span><span class="o">.</span><span class="n">analyse_samples</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17:03 madminer.lhe         INFO    Analysing LHE sample mg_processes/signal1/Events/run_01/unweighted_events.lhe.gz: Calculating 3 observables, requiring 3 selection cuts, using 0 efficiency factors, associated with no systematics
17:03 madminer.lhe         DEBUG   Extracting nuisance parameter definitions from LHE file
17:03 madminer.utils.inter DEBUG   Parsing nuisance parameter setup from LHE file at mg_processes/signal1/Events/run_01/unweighted_events.lhe.gz
17:03 madminer.utils.inter DEBUG   Systematics setup: OrderedDict()
17:03 madminer.utils.inter DEBUG   1 weight groups
17:03 madminer.lhe         DEBUG   systematics_dict: OrderedDict()
17:03 madminer.utils.inter DEBUG   Parsing LHE file mg_processes/signal1/Events/run_01/unweighted_events.lhe.gz
17:03 madminer.utils.inter DEBUG   Parsing header and events as XML with cElementTree
17:03 madminer.utils.inter DEBUG   Found entry event_norm = sum in LHE header. Interpreting this as weight_norm_is_average = False.
17:03 madminer.utils.inter DEBUG   Event 1 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 2 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 3 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 4 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 5 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 6 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 7 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 8 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 9 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 10 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 11 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 12 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 13 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 14 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 15 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 16 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 17 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 18 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 19 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 20 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter INFO      50000 / 50000 events pass cut (a[0] + a[1]).m &gt; 122.
17:03 madminer.utils.inter INFO      50000 / 50000 events pass cut (a[0] + a[1]).m &lt; 128.
17:03 madminer.utils.inter INFO      49991 / 50000 events pass cut pt_j1 &gt; 20.
17:03 madminer.utils.inter INFO      49991 events pass all cuts/efficiencies
17:03 madminer.lhe         DEBUG   Found weights [u&#39;sm&#39;, u&#39;w&#39;, u&#39;neg_w&#39;, u&#39;ww&#39;, u&#39;neg_ww&#39;, u&#39;morphing_basis_vector_5&#39;] in LHE file
17:03 madminer.lhe         DEBUG   Found 49991 events
17:03 madminer.lhe         INFO    Analysing LHE sample mg_processes/signal2/Events/run_01/unweighted_events.lhe.gz: Calculating 3 observables, requiring 3 selection cuts, using 0 efficiency factors, associated with no systematics
17:03 madminer.lhe         DEBUG   Extracting nuisance parameter definitions from LHE file
17:03 madminer.utils.inter DEBUG   Parsing nuisance parameter setup from LHE file at mg_processes/signal2/Events/run_01/unweighted_events.lhe.gz
17:03 madminer.utils.inter DEBUG   Systematics setup: OrderedDict()
17:03 madminer.utils.inter DEBUG   1 weight groups
17:03 madminer.lhe         DEBUG   systematics_dict: OrderedDict()
17:03 madminer.utils.inter DEBUG   Parsing LHE file mg_processes/signal2/Events/run_01/unweighted_events.lhe.gz
17:03 madminer.utils.inter DEBUG   Parsing header and events as XML with cElementTree
17:03 madminer.utils.inter DEBUG   Found entry event_norm = sum in LHE header. Interpreting this as weight_norm_is_average = False.
17:03 madminer.utils.inter DEBUG   Event 1 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 2 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 3 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 4 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 5 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 6 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 7 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 8 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 9 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 10 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 11 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 12 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 13 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 14 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 15 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 16 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 17 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 18 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 19 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 20 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter INFO      10000 / 10000 events pass cut (a[0] + a[1]).m &gt; 122.
17:03 madminer.utils.inter INFO      10000 / 10000 events pass cut (a[0] + a[1]).m &lt; 128.
17:03 madminer.utils.inter INFO      10000 / 10000 events pass cut pt_j1 &gt; 20.
17:03 madminer.utils.inter INFO      10000 events pass all cuts/efficiencies
17:03 madminer.lhe         DEBUG   Found weights [u&#39;sm&#39;, u&#39;w&#39;, u&#39;neg_w&#39;, u&#39;ww&#39;, u&#39;neg_ww&#39;, u&#39;morphing_basis_vector_5&#39;] in LHE file
17:03 madminer.lhe         DEBUG   Found 10000 events
17:03 root                 DEBUG   Merging data extracted from this file with data from previous files
17:03 root                 DEBUG     Weights for benchmark sm exist in both
17:03 root                 DEBUG     Weights for benchmark w exist in both
17:03 root                 DEBUG     Weights for benchmark neg_w exist in both
17:03 root                 DEBUG     Weights for benchmark ww exist in both
17:03 root                 DEBUG     Weights for benchmark neg_ww exist in both
17:03 root                 DEBUG     Weights for benchmark morphing_basis_vector_5 exist in both
17:03 madminer.lhe         INFO    Analysing LHE sample mg_processes/signal2/Events/run_02/unweighted_events.lhe.gz: Calculating 3 observables, requiring 3 selection cuts, using 0 efficiency factors, associated with no systematics
17:03 madminer.lhe         DEBUG   Extracting nuisance parameter definitions from LHE file
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17:03 madminer.utils.inter DEBUG   Parsing nuisance parameter setup from LHE file at mg_processes/signal2/Events/run_02/unweighted_events.lhe.gz
17:03 madminer.utils.inter DEBUG   Systematics setup: OrderedDict()
17:03 madminer.utils.inter DEBUG   1 weight groups
17:03 madminer.lhe         DEBUG   systematics_dict: OrderedDict()
17:03 madminer.utils.inter DEBUG   Parsing LHE file mg_processes/signal2/Events/run_02/unweighted_events.lhe.gz
17:03 madminer.utils.inter DEBUG   Parsing header and events as XML with cElementTree
17:03 madminer.utils.inter DEBUG   Found entry event_norm = sum in LHE header. Interpreting this as weight_norm_is_average = False.
17:03 madminer.utils.inter DEBUG   Event 1 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 2 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 3 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 4 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 5 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 6 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 7 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 8 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 9 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 10 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 11 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 12 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 13 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 14 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 15 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 16 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 17 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 18 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 19 passes observations, passes cuts, passes efficiencies -&gt; passes
17:03 madminer.utils.inter DEBUG   Event 20 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter INFO      10000 / 10000 events pass cut (a[0] + a[1]).m &gt; 122.
17:04 madminer.utils.inter INFO      10000 / 10000 events pass cut (a[0] + a[1]).m &lt; 128.
17:04 madminer.utils.inter INFO      10000 / 10000 events pass cut pt_j1 &gt; 20.
17:04 madminer.utils.inter INFO      10000 events pass all cuts/efficiencies
17:04 madminer.lhe         DEBUG   Found weights [u&#39;sm&#39;, u&#39;w&#39;, u&#39;neg_w&#39;, u&#39;ww&#39;, u&#39;neg_ww&#39;, u&#39;morphing_basis_vector_5&#39;] in LHE file
17:04 madminer.lhe         DEBUG   Found 10000 events
17:04 root                 DEBUG   Merging data extracted from this file with data from previous files
17:04 root                 DEBUG     Weights for benchmark sm exist in both
17:04 root                 DEBUG     Weights for benchmark w exist in both
17:04 root                 DEBUG     Weights for benchmark neg_w exist in both
17:04 root                 DEBUG     Weights for benchmark ww exist in both
17:04 root                 DEBUG     Weights for benchmark neg_ww exist in both
17:04 root                 DEBUG     Weights for benchmark morphing_basis_vector_5 exist in both
17:04 madminer.lhe         INFO    Analysing LHE sample mg_processes/signal2/Events/run_03/unweighted_events.lhe.gz: Calculating 3 observables, requiring 3 selection cuts, using 0 efficiency factors, associated with no systematics
17:04 madminer.lhe         DEBUG   Extracting nuisance parameter definitions from LHE file
17:04 madminer.utils.inter DEBUG   Parsing nuisance parameter setup from LHE file at mg_processes/signal2/Events/run_03/unweighted_events.lhe.gz
17:04 madminer.utils.inter DEBUG   Systematics setup: OrderedDict()
17:04 madminer.utils.inter DEBUG   1 weight groups
17:04 madminer.lhe         DEBUG   systematics_dict: OrderedDict()
17:04 madminer.utils.inter DEBUG   Parsing LHE file mg_processes/signal2/Events/run_03/unweighted_events.lhe.gz
17:04 madminer.utils.inter DEBUG   Parsing header and events as XML with cElementTree
17:04 madminer.utils.inter DEBUG   Found entry event_norm = sum in LHE header. Interpreting this as weight_norm_is_average = False.
17:04 madminer.utils.inter DEBUG   Event 1 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 2 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 3 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 4 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 5 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 6 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 7 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 8 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 9 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 10 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 11 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 12 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 13 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 14 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 15 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 16 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 17 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 18 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 19 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 20 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter INFO      10000 / 10000 events pass cut (a[0] + a[1]).m &gt; 122.
17:04 madminer.utils.inter INFO      10000 / 10000 events pass cut (a[0] + a[1]).m &lt; 128.
17:04 madminer.utils.inter INFO      10000 / 10000 events pass cut pt_j1 &gt; 20.
17:04 madminer.utils.inter INFO      10000 events pass all cuts/efficiencies
17:04 madminer.lhe         DEBUG   Found weights [u&#39;sm&#39;, u&#39;w&#39;, u&#39;neg_w&#39;, u&#39;ww&#39;, u&#39;neg_ww&#39;, u&#39;morphing_basis_vector_5&#39;] in LHE file
17:04 madminer.lhe         DEBUG   Found 10000 events
17:04 root                 DEBUG   Merging data extracted from this file with data from previous files
17:04 root                 DEBUG     Weights for benchmark sm exist in both
17:04 root                 DEBUG     Weights for benchmark w exist in both
17:04 root                 DEBUG     Weights for benchmark neg_w exist in both
17:04 root                 DEBUG     Weights for benchmark ww exist in both
17:04 root                 DEBUG     Weights for benchmark neg_ww exist in both
17:04 root                 DEBUG     Weights for benchmark morphing_basis_vector_5 exist in both
17:04 madminer.lhe         INFO    Analysing LHE sample mg_processes/signal2/Events/run_04/unweighted_events.lhe.gz: Calculating 3 observables, requiring 3 selection cuts, using 0 efficiency factors, associated with no systematics
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17:04 madminer.lhe         DEBUG   Extracting nuisance parameter definitions from LHE file
17:04 madminer.utils.inter DEBUG   Parsing nuisance parameter setup from LHE file at mg_processes/signal2/Events/run_04/unweighted_events.lhe.gz
17:04 madminer.utils.inter DEBUG   Systematics setup: OrderedDict()
17:04 madminer.utils.inter DEBUG   1 weight groups
17:04 madminer.lhe         DEBUG   systematics_dict: OrderedDict()
17:04 madminer.utils.inter DEBUG   Parsing LHE file mg_processes/signal2/Events/run_04/unweighted_events.lhe.gz
17:04 madminer.utils.inter DEBUG   Parsing header and events as XML with cElementTree
17:04 madminer.utils.inter DEBUG   Found entry event_norm = sum in LHE header. Interpreting this as weight_norm_is_average = False.
17:04 madminer.utils.inter DEBUG   Event 1 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 2 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 3 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 4 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 5 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 6 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 7 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 8 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 9 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 10 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 11 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 12 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 13 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 14 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 15 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 16 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 17 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 18 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 19 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter DEBUG   Event 20 passes observations, passes cuts, passes efficiencies -&gt; passes
17:04 madminer.utils.inter INFO      10000 / 10000 events pass cut (a[0] + a[1]).m &gt; 122.
17:04 madminer.utils.inter INFO      10000 / 10000 events pass cut (a[0] + a[1]).m &lt; 128.
17:04 madminer.utils.inter INFO      10000 / 10000 events pass cut pt_j1 &gt; 20.
17:04 madminer.utils.inter INFO      10000 events pass all cuts/efficiencies
17:04 madminer.lhe         DEBUG   Found weights [u&#39;sm&#39;, u&#39;w&#39;, u&#39;neg_w&#39;, u&#39;ww&#39;, u&#39;neg_ww&#39;, u&#39;morphing_basis_vector_5&#39;] in LHE file
17:04 madminer.lhe         DEBUG   Found 10000 events
17:04 root                 DEBUG   Merging data extracted from this file with data from previous files
17:04 root                 DEBUG     Weights for benchmark sm exist in both
17:04 root                 DEBUG     Weights for benchmark w exist in both
17:04 root                 DEBUG     Weights for benchmark neg_w exist in both
17:04 root                 DEBUG     Weights for benchmark ww exist in both
17:04 root                 DEBUG     Weights for benchmark neg_ww exist in both
17:04 root                 DEBUG     Weights for benchmark morphing_basis_vector_5 exist in both
17:04 madminer.lhe         INFO    Analysed number of events per sampling benchmark:
17:04 madminer.lhe         INFO      49991 from sm
17:04 madminer.lhe         INFO      10000 from w
17:04 madminer.lhe         INFO      10000 from neg_w
17:04 madminer.lhe         INFO      10000 from ww
17:04 madminer.lhe         INFO      10000 from neg_ww
</pre></div>
</div>
</div>
</div>
<p>The values of the observables and the weights are then saved in the HDF5 file. It is possible to overwrite the same file, or to leave the original file intact and save all the data into a new file as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lhe</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;data/lhe_data.h5&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17:04 madminer.lhe         DEBUG   Loading HDF5 data from data/setup.h5 and saving file to data/lhe_data.h5
17:04 madminer.lhe         DEBUG   Weight names: [u&#39;sm&#39;, u&#39;w&#39;, u&#39;neg_w&#39;, u&#39;ww&#39;, u&#39;neg_ww&#39;, u&#39;morphing_basis_vector_5&#39;]
17:04 madminer.utils.inter DEBUG   HDF5 file does not contain is_reference field.
17:04 madminer.utils.inter DEBUG   Benchmark morphing_basis_vector_5 already in benchmark_names_phys
17:04 madminer.utils.inter DEBUG   Benchmark neg_w already in benchmark_names_phys
17:04 madminer.utils.inter DEBUG   Benchmark neg_ww already in benchmark_names_phys
17:04 madminer.utils.inter DEBUG   Benchmark sm already in benchmark_names_phys
17:04 madminer.utils.inter DEBUG   Benchmark w already in benchmark_names_phys
17:04 madminer.utils.inter DEBUG   Benchmark ww already in benchmark_names_phys
17:04 madminer.utils.inter DEBUG   Combined benchmark names: [u&#39;sm&#39;, u&#39;w&#39;, u&#39;neg_w&#39;, u&#39;ww&#39;, u&#39;neg_ww&#39;, u&#39;morphing_basis_vector_5&#39;]
17:04 madminer.utils.inter DEBUG   Combined is_nuisance: [0 0 0 0 0 0]
17:04 madminer.utils.inter DEBUG   Combined is_reference: [1 0 0 0 0 0]
17:04 madminer.utils.inter DEBUG   Weight names found in event file: [u&#39;sm&#39;, u&#39;w&#39;, u&#39;neg_w&#39;, u&#39;ww&#39;, u&#39;neg_ww&#39;, u&#39;morphing_basis_vector_5&#39;]
17:04 madminer.utils.inter DEBUG   Benchmarks found in MadMiner file: [u&#39;sm&#39;, u&#39;w&#39;, u&#39;neg_w&#39;, u&#39;ww&#39;, u&#39;neg_ww&#39;, u&#39;morphing_basis_vector_5&#39;]
17:04 madminer.sampling    DEBUG   Combining and shuffling samples
17:04 madminer.sampling    DEBUG   Copying setup from data/lhe_data.h5 to data/lhe_data.h5
17:04 madminer.sampling    DEBUG   Loading samples from file 1 / 1 at data/lhe_data.h5, multiplying weights with k factor 1.0
17:04 madminer.sampling    DEBUG   Sampling benchmarks: [0 0 0 ... 4 4 4]
17:04 madminer.sampling    DEBUG   Combined sampling benchmarks: [0 0 0 ... 4 4 4]
17:04 madminer.sampling    DEBUG   Recalculated event numbers per benchmark: [49991 10000 10000 10000 10000     0], background: 0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-distributions">
<h2>6. Plot distributions<a class="headerlink" href="#plot-distributions" title="Permalink to this headline">¶</a></h2>
<p>Let’s see what our MC run produced:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">plot_distributions</span><span class="p">(</span>
    <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;data/lhe_data.h5&#39;</span><span class="p">,</span>
    <span class="n">parameter_points</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sm&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">10.</span><span class="p">,</span><span class="mf">0.</span><span class="p">])],</span>
    <span class="n">line_labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SM&#39;</span><span class="p">,</span> <span class="s1">&#39;BSM&#39;</span><span class="p">],</span>
    <span class="n">uncertainties</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
    <span class="n">n_bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">n_cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">sample_only_from_closest_benchmark</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17:04 madminer.analysis    INFO    Loading data from data/lhe_data.h5
17:04 madminer.analysis    INFO    Found 2 parameters
17:04 madminer.analysis    DEBUG      CWL2 (LHA: dim6 2, maximal power in squared ME: (2,), range: (-20.0, 20.0))
17:04 madminer.analysis    DEBUG      CPWL2 (LHA: dim6 5, maximal power in squared ME: (2,), range: (-20.0, 20.0))
17:04 madminer.analysis    INFO    Did not find nuisance parameters
17:04 madminer.analysis    INFO    Found 6 benchmarks, of which 6 physical
17:04 madminer.analysis    DEBUG      sm: CWL2 = 0.00e+00, CPWL2 = 0.00e+00
17:04 madminer.analysis    DEBUG      w: CWL2 = 15.20, CPWL2 = 0.10
17:04 madminer.analysis    DEBUG      neg_w: CWL2 = -1.54e+01, CPWL2 = 0.20
17:04 madminer.analysis    DEBUG      ww: CWL2 = 0.30, CPWL2 = 15.10
17:04 madminer.analysis    DEBUG      neg_ww: CWL2 = 0.40, CPWL2 = -1.53e+01
17:04 madminer.analysis    DEBUG      morphing_basis_vector_5: CWL2 = 16.88, CPWL2 = 14.95
17:04 madminer.analysis    INFO    Found 3 observables
17:04 madminer.analysis    DEBUG      0 pt_j1
17:04 madminer.analysis    DEBUG      1 delta_phi_jj
17:04 madminer.analysis    DEBUG      2 met
17:04 madminer.analysis    INFO    Found 89991 events
17:04 madminer.analysis    INFO      49991 signal events sampled from benchmark sm
17:04 madminer.analysis    INFO      10000 signal events sampled from benchmark w
17:04 madminer.analysis    INFO      10000 signal events sampled from benchmark neg_w
17:04 madminer.analysis    INFO      10000 signal events sampled from benchmark ww
17:04 madminer.analysis    INFO      10000 signal events sampled from benchmark neg_ww
17:04 madminer.analysis    INFO    Found morphing setup with 6 components
17:04 madminer.analysis    INFO    Did not find nuisance morphing setup
17:04 madminer.plotting    DEBUG   Observable indices: [0, 1, 2]
17:04 madminer.plotting    DEBUG   Calculated 2 theta matrices
17:04 madminer.analysis    DEBUG   Sampling benchmark closest to None: None
17:04 madminer.analysis    DEBUG   Events per benchmark: [49991. 10000. 10000. 10000. 10000.     0.]
17:04 madminer.plotting    DEBUG   Loaded raw data with shapes (89991, 3), (89991, 6)
17:04 madminer.analysis    DEBUG   Sampling benchmark closest to [0. 0.]: 0
17:04 madminer.analysis    DEBUG   Sampling benchmark closest to [10.  0.]: 1
17:04 madminer.plotting    DEBUG   Plotting panel 0: observable 0, label pt_j1
17:04 madminer.plotting    DEBUG   Ranges for observable pt_j1: min = [20.172650642695523, 20.172650642695523], max = [308.68458504027717, 1578.1646035292065]
17:04 madminer.plotting    DEBUG   Plotting panel 1: observable 1, label delta_phi_jj
17:04 madminer.plotting    DEBUG   Ranges for observable delta_phi_jj: min = [-3.141586511001732, -3.141586511001732], max = [3.141542330470944, 3.141542330470944]
17:04 madminer.plotting    DEBUG   Plotting panel 2: observable 2, label met
17:04 madminer.plotting    DEBUG   Ranges for observable met: min = [0.1060288929419313, 0.1060288929419313], max = [105.62721157551425, 351.0223478095247]
</pre></div>
</div>
<img alt="../../../_images/2a_parton_analysis_42_1.png" src="../../../_images/2a_parton_analysis_42_1.png" />
</div>
</div>
</div>
<div class="section" id="combine-and-shuffle-different-samples">
<h2>7. Combine and shuffle different samples<a class="headerlink" href="#combine-and-shuffle-different-samples" title="Permalink to this headline">¶</a></h2>
<p>To reduce disk usage, you can generate several small event samples with the steps given above, and combine them now. Note that (for now) it is essential that all of them are generated with the same setup, including the same benchmark points / morphing basis!</p>
<p>This is generally good practice even if you use just one sample, since the events might have some inherent ordering (e.g. from sampling from different hypotheses). Later when we split the events into a training and test fraction, such an ordering could cause problems.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">combine_and_shuffle</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;data/lhe_data.h5&#39;</span><span class="p">],</span>
    <span class="s1">&#39;data/lhe_data_shuffled.h5&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17:04 madminer.sampling    DEBUG   Combining and shuffling samples
17:04 madminer.sampling    DEBUG   Copying setup from data/lhe_data.h5 to data/lhe_data_shuffled.h5
17:04 madminer.sampling    DEBUG   Loading samples from file 1 / 1 at data/lhe_data.h5, multiplying weights with k factor 1.0
17:04 madminer.sampling    DEBUG   Sampling benchmarks: [0 0 1 ... 0 2 1]
17:04 madminer.sampling    DEBUG   Combined sampling benchmarks: [0 0 1 ... 0 2 1]
17:04 madminer.sampling    DEBUG   Recalculated event numbers per benchmark: [49991 10000 10000 10000 10000     0], background: 0
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./tutorial/notebooks/general"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="../../5_data_generation.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Choose your adventure</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="2b_delphes_analysis.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">MadMiner physics tutorial (part 2B)</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Kyle Cranmer<br/>
        
            &copy; Copyright 2021.<br/>
          <div class="extra_footer">
            This page was created by the <a href="https://github.com/madminer-tool/madminer">MadMiner Team</a>.
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>